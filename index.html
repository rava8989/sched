<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>307 Schedule</title>

<style>
:root{
  --grid:#6a6a6a;

  --hdr9:#1a1a1a;   /* header rows */
  --sun7:#4d4d4d;   /* Sunday column */
  --sat5:#7a7a7a;   /* Saturday column */
  --wk:#f6f6f6;     /* weekday base */

  --row2:#e6e6e6;
  --row1:#f0f0f0;

  --holiday:#b30000;
}

body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#fff; }

header{
  position:sticky; top:0; z-index:20;
  background:#fff;
  border-bottom:2px solid var(--grid);
  padding:8px;
}

.controls{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center;
}

select,input,button{
  padding:6px 8px;
  font-size:14px;
  border:2px solid var(--grid);
  border-radius:8px;
  background:#fff;
}
button{ cursor:pointer }

.wrap{ padding:8px; }

.panel{
  border:2px solid var(--grid);
  border-radius:10px;
  margin-bottom:12px;
  overflow:hidden;
}

.monthHeader{
  background:var(--hdr9);
  color:#fff;
  padding:8px 12px;
  font-weight:900;
  text-transform:uppercase;
  font-size:14px;
}

.scroll{ overflow-x:auto; -webkit-overflow-scrolling:touch; }

table{
  border-collapse:collapse;
  font-family:ui-monospace,Menlo,Consolas,monospace;
  font-size:12px;
  width:max-content;
  min-width:100%;
}

th,td{
  border:1px solid var(--grid);
  text-align:center;
  padding:0;
  height:28px;
  min-width:34px;
  font-weight:900;
}

/* sticky NAME */
th.name, td.name{
  position:sticky;
  left:0;
  z-index:6;
  text-align:left;
  padding:0 8px;
  min-width:190px;
  font-family:system-ui;
}

/* column colors */
.wkCol{ background:var(--wk) !important; color:#111; }
.satCol{ background:var(--sat5) !important; color:#111; }
.sunCol{ background:var(--sun7) !important; color:#fff; }

/* row striping – weekday cells only */
tr.r2 td.wkCol{ background:var(--row2) !important; }
tr.r1 td.wkCol{ background:var(--row1) !important; }
tr.r2 td.name{ background:var(--row2) !important; }
tr.r1 td.name{ background:var(--row1) !important; }

/* header rows override weekend colors */
tr.hdrRow th{ background:var(--hdr9) !important; color:#fff !important; }
tr.hdrRow th.name{ background:var(--hdr9) !important; }

/* HOL */
td.hol{ color:var(--holiday) !important; font-weight:1000; }

@media (max-width:700px){
  th.name, td.name{ min-width:150px; }
  table{ font-size:11px; }
}
</style>
</head>

<body>
<header>
  <div class="controls">
    <label>Start Month <input id="startMonth" type="month"></label>
    <label>Show Months
      <select id="showMonths">
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </label>
    <button id="prev">◀</button>
    <button id="next">▶</button>
    <button id="today">This Month</button>
  </div>
</header>

<div class="wrap" id="wrap"></div>

<script>
/* ================= BASE DATA ================= */

const LOOP = 42;

const SLOTS = {
1:["R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R"],
2:["C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C"],
3:["B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO"],
4:["RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO"],
5:["MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A"],
6:["B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B"]
};

const PEOPLE=[
 {n:"Kingston, Joseph C.",s:1},
 {n:"Rodriguez, Roger",s:1},
 {n:"Joseph, George R",s:2},
 {n:"Ramnarine, Ashram",s:2},
 {n:"Segovia, Eduardo M",s:3},
 {n:"Victoria, Robert",s:3},
 {n:"Bouaziz, Abdelghani",s:4},
 {n:"Gragossian, Alan",s:4},
 {n:"Handel, Joseph",s:5},
 {n:"Rakhmanov, Ravshan",s:5},
 {n:"Rodriguez, Alexander",s:6},
 {n:"Svenjak, Mark",s:6}
];

/* ===== FINAL HOLIDAYS – 2026 ===== */
const HOLIDAYS_2026 = new Set([
  "2026-01-01",
  "2026-01-19",
  "2026-02-16",
  "2026-05-25",
  "2026-06-19",
  "2026-07-03",
  "2026-07-06",
  "2026-09-07",
  "2026-10-12",
  "2026-11-11",
  "2026-11-26",
  "2026-11-27",
  "2026-12-25"
]);

/* ================= UTC UTIL ================= */

const pad=n=>String(n).padStart(2,"0");
function makeUTC(y,m,d){ return new Date(Date.UTC(y,m,d)); }
function isoUTC(d){
  return `${d.getUTCFullYear()}-${pad(d.getUTCMonth()+1)}-${pad(d.getUTCDate())}`;
}
function addDaysUTC(d,n){ return new Date(d.getTime()+n*86400000); }
function dowUTC(d){ return d.getUTCDay(); }
function idx(i){ return ((i%LOOP)+LOOP)%LOOP; }

const ANCHOR_UTC_MS = Date.UTC(2026,0,1);

function baseCode(slot,d){
  const di=Math.floor((d.getTime()-ANCHOR_UTC_MS)/86400000);
  return SLOTS[slot][idx(di)];
}

function isWeekend(d){ const w=dowUTC(d); return w===0||w===6; }
function isWeekday(d){ const w=dowUTC(d); return w>=1&&w<=5; }
function isDouble(c){ return String(c).includes("/"); }
function isAC(c){ return c==="A"||c==="C"||isDouble(c); }
function isOff(c){ return c==="RDO"||c==="MDO"; }
function isReserve(c){ return c==="R"; }

function colClass(w){ return w===0?"sunCol":w===6?"satCol":"wkCol"; }

/* contiguous B run includes weekend */
function bRunIncludesWeekend(date, baseMap){
  const di=isoUTC(date);
  if(baseMap.get(di)!=="B") return false;

  let s=date;
  while(baseMap.get(isoUTC(addDaysUTC(s,-1)))==="B") s=addDaysUTC(s,-1);
  let e=date;
  while(baseMap.get(isoUTC(addDaysUTC(e,1)))==="B") e=addDaysUTC(e,1);

  for(let c=s; c<=e; c=addDaysUTC(c,1)){
    const w=dowUTC(c);
    if(w===0||w===6) return true;
  }
  return false;
}

/* ================= HOLIDAY LOGIC ================= */

function computeDisplay(rangeStart, rangeEnd){
  const baseMaps=new Map();
  PEOPLE.forEach(p=>{
    const m=new Map();
    for(let d=rangeStart; d<=rangeEnd; d=addDaysUTC(d,1)){
      m.set(isoUTC(d), baseCode(p.s,d));
    }
    baseMaps.set(p.n,m);
  });

  const holMap=new Map(), credits=new Map();
  PEOPLE.forEach(p=>{
    holMap.set(p.n,new Set());
    credits.set(p.n,0);
  });

  function placeCredit(name,fromISO){
    let d=addDaysUTC(new Date(fromISO+"T00:00:00Z"),1);
    const base=baseMaps.get(name), hols=holMap.get(name);
    for(let i=0;i<200;i++){
      const di=isoUTC(d);
      if(HOLIDAYS_2026.has(di)){ d=addDaysUTC(d,1); continue; } // never place HOL on a holiday date
      if(isWeekday(d) && base.get(di)==="B" && !hols.has(di)){
        hols.add(di); return true;
      }
      d=addDaysUTC(d,1);
    }
    return false;
  }

  function pickBWorkers(hDate){
    const di=isoUTC(hDate), dow=dowUTC(hDate);
    const cands=PEOPLE.filter(p=>baseMaps.get(p.n).get(di)==="B");
    if(isWeekend(hDate)) return new Set(cands.map(p=>p.n)); // weekend holiday: base-B covers

    const wantWeekend=(dow===1||dow===2||dow===4||dow===5); // Mon Tue Thu Fri -> Thu–Tue group
    const match=[],other=[];
    cands.forEach(p=>{
      const inc=bRunIncludesWeekend(hDate,baseMaps.get(p.n));
      (wantWeekend?inc:!inc)?match.push(p):other.push(p);
    });

    const pick=[...match,...other].slice(0,2); // exactly 2 weekday holiday B workers
    return new Set(pick.map(p=>p.n));
  }

  for(let d=rangeStart; d<=rangeEnd; d=addDaysUTC(d,1)){
    const di=isoUTC(d);
    if(!HOLIDAYS_2026.has(di)) continue;

    const bWorkers=pickBWorkers(d);

    PEOPLE.forEach(p=>{
      const code=baseMaps.get(p.n).get(di);
      if(isReserve(code)) holMap.get(p.n).add(di);                      // R never works holiday
      else if(isOff(code) || isAC(code)) credits.set(p.n,credits.get(p.n)+1); // works/offs -> credit later
      else if(code==="B"){
        if(bWorkers.has(p.n)) credits.set(p.n,credits.get(p.n)+1);      // B works holiday -> credit later
        else holMap.get(p.n).add(di);                                   // B off holiday
      }
    });

    // place credits after this holiday
    PEOPLE.forEach(p=>{
      let c=credits.get(p.n);
      while(c>0){ if(!placeCredit(p.n,di)) break; c--; }
      credits.set(p.n,c);
    });
  }

  const display=new Map();
  PEOPLE.forEach(p=>{
    const dmap=new Map();
    for(let d=rangeStart; d<=rangeEnd; d=addDaysUTC(d,1)){
      const di=isoUTC(d);
      dmap.set(di, holMap.get(p.n).has(di)?"HOL":baseMaps.get(p.n).get(di));
    }
    display.set(p.n,dmap);
  });

  return {baseMaps,display};
}

/* ================= RENDER ================= */

const wrap=document.getElementById("wrap");
const startMonthEl=document.getElementById("startMonth");

/* ALWAYS start from CURRENT month (UTC) */
function currentMonthUTC(){
  const now = new Date();
  return makeUTC(now.getUTCFullYear(), now.getUTCMonth(), 1);
}
let startUTC = currentMonthUTC();

/* If current month is before Jan 2026, still start at current month,
   but schedule pattern itself is anchored to Jan 1, 2026 as requested. */

function setStartMonthInputFromStartUTC(){
  startMonthEl.value = `${startUTC.getUTCFullYear()}-${pad(startUTC.getUTCMonth()+1)}`;
}

function render(){
  wrap.innerHTML="";
  const months=+document.getElementById("showMonths").value;

  const rs=makeUTC(startUTC.getUTCFullYear(),startUTC.getUTCMonth(),1);
  const re=addDaysUTC(makeUTC(startUTC.getUTCFullYear(),startUTC.getUTCMonth()+12,1),200);
  const comp=computeDisplay(rs,re);

  for(let i=0;i<months;i++){
    const mUTC=makeUTC(startUTC.getUTCFullYear(),startUTC.getUTCMonth()+i,1);
    const y=mUTC.getUTCFullYear(), m=mUTC.getUTCMonth();
    const days=makeUTC(y,m+1,0).getUTCDate();

    const panel=document.createElement("div"); panel.className="panel";
    panel.innerHTML=`<div class="monthHeader">${mUTC.toLocaleString("default",{month:"long",timeZone:"UTC"})} ${y}</div>`;
    const sc=document.createElement("div"); sc.className="scroll";
    const t=document.createElement("table");

    // date row
    let tr=document.createElement("tr"); tr.className="hdrRow";
    tr.innerHTML=`<th class="name">NAME</th>`;
    for(let d=1;d<=days;d++){ tr.innerHTML+=`<th>${d}</th>`; }
    t.appendChild(tr);

    // dow row
    tr=document.createElement("tr"); tr.className="hdrRow";
    tr.innerHTML=`<th class="name"></th>`;
    const dows=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    for(let d=1;d<=days;d++){ tr.innerHTML+=`<th>${dows[dowUTC(makeUTC(y,m,d))]}</th>`; }
    t.appendChild(tr);

    // people rows
    PEOPLE.forEach((p,i)=>{
      const r=document.createElement("tr"); r.className=i%2?"r1":"r2";
      r.innerHTML=`<td class="name">${p.n}</td>`;
      for(let d=1;d<=days;d++){
        const dt=makeUTC(y,m,d), di=isoUTC(dt);
        const td=document.createElement("td");
        td.className=colClass(dowUTC(dt));
        const val=comp.display.get(p.n).get(di);
        if(val==="HOL"){ td.classList.add("hol"); td.textContent="HOL"; }
        else td.textContent=val;
        r.appendChild(td);
      }
      t.appendChild(r);
    });

    sc.appendChild(t); panel.appendChild(sc); wrap.appendChild(panel);
  }
}

/* ================= CONTROLS ================= */

document.getElementById("showMonths").onchange=()=>{ setStartMonthInputFromStartUTC(); render(); };

document.getElementById("prev").onclick=()=>{
  startUTC = makeUTC(startUTC.getUTCFullYear(), startUTC.getUTCMonth()-1, 1);
  setStartMonthInputFromStartUTC();
  render();
};

document.getElementById("next").onclick=()=>{
  startUTC = makeUTC(startUTC.getUTCFullYear(), startUTC.getUTCMonth()+1, 1);
  setStartMonthInputFromStartUTC();
  render();
};

document.getElementById("today").onclick=()=>{
  startUTC = currentMonthUTC();
  setStartMonthInputFromStartUTC();
  render();
};

/* manual month picker */
startMonthEl.onchange=(e)=>{
  const [yy,mm]=e.target.value.split("-").map(Number);
  startUTC = makeUTC(yy, mm-1, 1);
  setStartMonthInputFromStartUTC();
  render();
};

/* init */
startUTC = currentMonthUTC();     // <-- always start from current month
setStartMonthInputFromStartUTC();
render();
</script>
</body>
</html>
